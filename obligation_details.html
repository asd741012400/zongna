<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta id="meta" name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1 maximum-scale=2, user-scalable=no">
	<title>订单详情</title>
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/obligation_details.css">
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript" src="js/jquery.js"></script>
</head>

<body>


<div class="header">
	<p></p>
<!-- 	<ul>
		<li>剩余：01小时40分钟</li>
		<li class="total_money">需付款：￥359.00</li>
	</ul> -->
</div>

<div class="site">
	<h3></h3>
	<p></p>
</div>

<div class="indent">
	<div class="due_out">
		<div>
			<ul>
			</ul>
		</div>
	</div>
</div>  


<div class="delivery">
	<ul>
		<li>订单编号：<span class="c_sn"></span></li>
		<li>下单时间：<span class="order_time"></span></li>
	</ul>
	<!-- <p>配送方式：<span></span></p> -->
</div>


<div class="vip_code">
	<p>
		<a>会员码</a>
		<!-- <span> <input type="text" name="" placeholder="请输入会员码，立享会员价"></span> -->
		<span></span>
	</p>
</div>


<div class="payment_count">
	<ul>
		<li>
			<span>商品总额</span>
			<!-- <i>+运费</i> -->
		</li>
		<li class="money">
			<span></span>
			<!-- <i>¥0.00</i> -->
		</li>
	</ul>
	<p>需付款： <span></span></p>
</div>

<div class="payment">
	<span>联系卖家</span>
	<span class="cancelBtn">取消订单</span>
	<span class="fu">付款</span>
</div>

<div class="tan">
	<ul class="cancel">
		<li><p>确认取消这<i></i>件商品吗？</p></li>
		<li>
			<span>取消</span>
			<a>确定</a>
		</li>
	</ul>
</div>

<style type="text/css">

</style>




<script src="js/public.js"></script>
<script type="text/javascript" src="js/pay.js"></script>
<script type="text/javascript">

// var uId = localStorage.getItem("uId");
var user_Id = localStorage.getItem("userId");
// let uId = 1;
var ajaxUrl = grtAjaxUrl();
var Request = GetRequest();
var payorderId = Request["payorder_id"];
var orderList = [];
var merchantList = [];
var orderDetail = [];


$(document).ready(function () {

	yDataAjax( ajaxUrl+"Home/Order/orderDetail" , "get" , {
		user_id : user_Id,
		payorder_id : payorderId
	} , function( data ){
		console.log( data )
		if( data.status )
		{
			$('.header').attr("order_id" , data.data.order_id)
			$('.header p').html( data.data.c_pay_statu );
			$('.total_money').html(`需付款：￥${data.data.c_total_money}`);
			$(".site h3").html(`收货人：${data.data.c_shuohuoname} <span>${data.data.c_tel}</span>`);
			$(".site p").html(`${data.data.c_provinces}${data.data.c_city}${data.data.c_zone}${data.data.c_street}`)
			$(".c_sn").html(`${data.data.c_sn}`)
			$(".order_time").html(`${data.data.c_order_time}`)

			$('.delivery p span').html(data.data.c_kuaidi)
			$('.payment_count .money span').html(data.data.c_total_money)
			$('.payment_count p span').html(data.data.c_pay_money)

			if( data.data.c_code )
			{

				$('.vip_code span').html(data.data.c_code)
				$('.vip_code').show()
			}
			else
			{
				$('.vip_code').hide()
			}

			if( data.data.rows )
			{
				$.each( data.data.rows , function(index, val) {
					 /* iterate through array or object */
				
					merchantList.push( val )

				
				});

				$.each( merchantList , function(index, val) {
					 /* iterate through array or object */
				
					$.each( val.orderDetail , function(index2,val2){

						orderDetail.push( val2 )
					});
					
				});

				$.each( orderDetail , function(index, val) {
					 /* iterate through array or object */
					console.log( val )
					$('.due_out div ul').append(
						`<li>
							<b class="details_img"><img src="${val.c_image}" alt=""></b>
							<div>
								<h2>${val.c_title}</h2>
								<span>规格：${val.c_guige}</span>
								<p>
									<b>¥${val.c_price}</b>
									<em>¥${val.c_vipprice}</em>
									<strong><img src="images/VIP_price.png" alt=""></strong>
									<i>x${val.c_num}</i>
								</p>
							</div>
						</li>`)
				});




			}




			console.log( data )

		}
	})
	

})

$('.payment .cancelBtn').click(function(event) {
	var orderId = $('.header').attr('order_id');
	var num = $('.due_out div ul li').length;
	
	$('.tan .cancel li p i').html( num )
	$('.tan').show();
	$('.tan .cancel').show();

	tan( orderId , $('.tan .cancel'))

});

$('.payment .fu').click(function(event) {

	var orderId = $('.header').attr('order_id');
	getPay( orderId , user_Id , "../due_out_deteils.html?order_id="+orderId)


});



function tan( orderId , obj ){

	obj.find('li').find('span').click(function(event) {
		obj.hide();
		$('.tan').hide();
	});


	obj.find('li').find('a').click(function(event) {
		obj.hide();
		$('.tan').hide();

		yDataAjax( ajaxUrl+"Home/Order/cancel" , "get" , {
			user_id : user_Id,
			payorder_id : payorderId,
		} , function( data ){


			if( data.status )
			{

				window.location.href = "defeated_details.html?payorder_id="+payorderId;
			}


		})


	});

}
</script>


</body>
</html>



